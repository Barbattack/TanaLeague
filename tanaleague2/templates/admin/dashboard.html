{% extends "base.html" %}

{% block title %}Admin Panel - TanaLeague{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1><i class="fas fa-shield-alt"></i> Admin Panel</h1>
        <p class="text-muted">Upload e importa tornei</p>
    </div>
    <div class="col-md-4 text-end">
        <!-- Session info -->
        {% if session_info %}
        <div class="alert alert-info mb-2">
            <small>
                <i class="fas fa-user"></i> {{ session_info.username }}<br>
                <i class="fas fa-clock"></i> {{ session_info.expires_in_minutes }} min rimanenti
            </small>
        </div>
        {% endif %}
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </div>
</div>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<!-- Info Panel -->
<div class="alert alert-warning mb-4">
    <h6><i class="fas fa-info-circle"></i> Istruzioni</h6>
    <ul class="mb-0 small">
        <li><strong>One Piece</strong>: Carica CSV dal portale Bandai (data nel nome file: YYYY_MM_DD_OP12.csv)</li>
        <li><strong>Pokemon</strong>: Carica TDF/XML da Play! Pokemon Tournament software</li>
        <li><strong>Riftbound</strong>: Carica PDF con tabella standings (nickname tra parentesi obbligatorio)</li>
        <li><strong>Test Mode</strong>: Simula import senza scrivere dati (consigliato prima volta)</li>
    </ul>
</div>

<!-- One Piece Import -->
<div class="card mb-4 border-danger">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0">üè¥‚Äç‚ò†Ô∏è One Piece TCG - Import CSV</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('admin_import_onepiece') }}" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="op_season" class="form-label">Stagione</label>
                    <select class="form-select" id="op_season" name="season" required>
                        <option value="">Seleziona stagione...</option>
                        {% for season in seasons_by_tcg.get('OP', []) %}
                            <option value="{{ season.id }}">
                                {{ season.name }}
                                {% if season.status == 'ACTIVE' %}<span class="badge bg-success">Attiva</span>{% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="op_file" class="form-label">File CSV</label>
                    <input type="file" class="form-control" id="op_file" name="file"
                           accept=".csv" required>
                    <div class="form-text">Formato: YYYY_MM_DD_OP12.csv</div>
                </div>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="op_test" name="test_mode">
                <label class="form-check-label" for="op_test">
                    <strong>Test Mode</strong> (dry run, non scrive dati)
                </label>
            </div>

            <button type="submit" class="btn btn-danger">
                <i class="fas fa-upload"></i> Importa One Piece
            </button>
        </form>
    </div>
</div>

<!-- Pokemon Import -->
<div class="card mb-4 border-warning">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">‚ö° Pok√©mon TCG - Import TDF/XML</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('admin_import_pokemon') }}" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="pkm_season" class="form-label">Stagione</label>
                    <select class="form-select" id="pkm_season" name="season" required>
                        <option value="">Seleziona stagione...</option>
                        {% for season in seasons_by_tcg.get('PKM', []) %}
                            <option value="{{ season.id }}">
                                {{ season.name }}
                                {% if season.status == 'ACTIVE' %}<span class="badge bg-success">Attiva</span>{% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="pkm_file" class="form-label">File TDF/XML</label>
                    <input type="file" class="form-control" id="pkm_file" name="file"
                           accept=".tdf,.xml" required>
                    <div class="form-text">Play! Pokemon Tournament export</div>
                </div>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="pkm_test" name="test_mode">
                <label class="form-check-label" for="pkm_test">
                    <strong>Test Mode</strong> (dry run, non scrive dati)
                </label>
            </div>

            <button type="submit" class="btn btn-warning text-dark">
                <i class="fas fa-upload"></i> Importa Pok√©mon
            </button>
        </form>
    </div>
</div>

<!-- Riftbound Import -->
<div class="card mb-4 border-info">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">üåå Riftbound TCG - Import PDF</h5>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('admin_import_riftbound') }}" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="rfb_season" class="form-label">Stagione</label>
                    <select class="form-select" id="rfb_season" name="season" required>
                        <option value="">Seleziona stagione...</option>
                        {% for season in seasons_by_tcg.get('RFB', []) %}
                            <option value="{{ season.id }}">
                                {{ season.name }}
                                {% if season.status == 'ACTIVE' %}<span class="badge bg-success">Attiva</span>{% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="rfb_file" class="form-label">File PDF</label>
                    <input type="file" class="form-control" id="rfb_file" name="file"
                           accept=".pdf" required>
                    <div class="form-text">PDF con tabella standings</div>
                </div>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="rfb_test" name="test_mode">
                <label class="form-check-label" for="rfb_test">
                    <strong>Test Mode</strong> (dry run, non scrive dati)
                </label>
            </div>

            <button type="submit" class="btn btn-info text-white">
                <i class="fas fa-upload"></i> Importa Riftbound
            </button>
        </form>
    </div>
</div>

<!-- Back to site -->
<div class="text-center mt-4">
    <a href="{{ url_for('index') }}" class="btn btn-secondary">
        <i class="fas fa-home"></i> Torna al Sito
    </a>
</div>
{% endblock %}
